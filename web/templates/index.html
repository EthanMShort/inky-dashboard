<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inky Dashboard</title>
    <style>
        :root {
            /* DARK MODE PALETTE */
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-main: #ecf0f1;
            --text-muted: #bdc3c7;
            --accent: #e74c3c; /* Inky Red */
            --border-radius: 12px;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 600px; /* Tighter width for better mobile/desktop feel */
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: var(--accent);
            font-weight: 700;
            margin-bottom: 30px;
            letter-spacing: 1px;
        }

        /* CARD STYLING */
        .card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3); /* Soft shadow for depth */
        }

        .card h2 {
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.1rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
        }

        /* STATUS BADGE */
        .status-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.95rem;
        }
        .status-badge {
            background-color: #2c3e50;
            color: #3498db;
            padding: 4px 10px;
            border-radius: 4px;
            font-weight: bold;
            font-family: monospace;
        }

        /* BUTTON GRID */
        .btn-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* 2 Columns for cleaner look */
            gap: 15px;
        }

        .btn {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
            text-decoration: none;
            color: white;
            font-weight: 600;
            border-radius: 8px;
            transition: transform 0.1s ease, filter 0.2s;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
            border: none;
            cursor: pointer;
            font-size: 1rem;
        }

        .btn:hover { filter: brightness(1.1); }
        .btn:active { transform: scale(0.97); }
        
        .btn.disabled {
            opacity: 0.5;
            pointer-events: none;
            filter: grayscale(0.8);
        }

        /* COLORS */
        .btn-sys { background-color: #34495e; }
        .btn-clean { background-color: #95a5a6; color: #2c3e50; }
        .btn-weather { background-color: #2980b9; }
        .btn-stocks { background-color: #f39c12; color: #2c3e50; }
        .btn-music { background-color: #c0392b; }
        
        .btn-restart { background-color: #7f8c8d; }
        .btn-reboot { background-color: #d35400; }
        .btn-shutdown { background-color: #c0392b; }

        /* FORM */
        form { display: flex; gap: 10px; }
        input[type="text"] {
            flex: 1;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #333;
            background-color: #121212;
            color: white;
            font-size: 1rem;
        }
        input[type="text"]:focus { outline: 2px solid var(--accent); }
        .btn-send { background-color: var(--accent); width: auto; padding: 0 25px; }

        /* LOADING OVERLAY */
        #loadingOverlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .spinner {
            width: 50px; height: 50px;
            border: 4px solid #333;
            border-top: 4px solid var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-bottom: 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .loading-text { color: white; font-weight: bold; letter-spacing: 1px; }

    </style>
</head>
<body>

    <div id="loadingOverlay">
        <div class="spinner"></div>
        <div class="loading-text">UPDATING DISPLAY...</div>
    </div>

    <div class="container">
        <h1>Inky Dashboard</h1>
        
        <div class="card">
            <h2>Status</h2>
            <div class="status-row">
                <div>
                    <span style="color:var(--text-muted)">Active:</span> 
                    <span id="currentScript" class="status-badge">...</span>
                </div>
                <div style="text-align: right; color: var(--text-muted); font-size: 0.85rem;">
                    <span id="cpuUsage">CPU: -%</span> &nbsp;|&nbsp; 
                    <span id="ramUsage">RAM: -%</span>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>Dashboards</h2>
            <div class="btn-grid">
                <a href="#" onclick="runAction('/run/dashboard')" class="btn btn-sys">üìä System</a>
                <a href="#" onclick="runAction('/run/weather')" class="btn btn-weather">‚òÅÔ∏è Weather</a>
                <a href="#" onclick="runAction('/run/music')" class="btn btn-music">üéµ Music</a>
                <a href="#" onclick="runAction('/run/clean')" class="btn btn-clean" style="grid-column: span 2;">üßπ Clean Display</a>
            </div>
        </div>

        <div class="card">
            <h2>Send Message</h2>
            <form action="/message" method="POST" onsubmit="showLoading()">
                <input type="text" name="text_input" placeholder="Type text..." required autocomplete="off">
                <button type="submit" class="btn btn-send">Send</button>
            </form>
        </div>

        <div class="card">
            <h2>Power</h2>
            <div class="btn-grid" style="grid-template-columns: repeat(3, 1fr);">
                <a href="#" onclick="runAction('/system/restart_service')" class="btn btn-restart">Restart Svc</a>
                <a href="#" onclick="runAction('/system/reboot')" class="btn btn-reboot">Reboot</a>
                <a href="#" onclick="runAction('/system/shutdown')" class="btn btn-shutdown">Shutdown</a>
            </div>
        </div>
    </div>

    <script>
        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
            document.querySelectorAll('.btn').forEach(b => b.classList.add('disabled'));
        }

        function runAction(url) {
            showLoading();
            setTimeout(() => { window.location.href = url; }, 100);
        }

        function updateStats() {
            fetch('/api/stats').then(r => r.json()).then(data => {
                document.getElementById('cpuUsage').innerText = `CPU: ${data.cpu}%`;
                document.getElementById('ramUsage').innerText = `RAM: ${data.ram}%`;
            });
            fetch('/api/status').then(r => r.json()).then(data => {
                const badge = document.getElementById('currentScript');
                badge.innerText = data.status;
                // Color code the status text
                if(data.status === 'Music') badge.style.color = '#e74c3c';
                else if(data.status === 'Stocks') badge.style.color = '#f1c40f';
                else if(data.status === 'Weather') badge.style.color = '#3498db';
                else badge.style.color = '#2ecc71';
            });
        }

        updateStats();
        setInterval(updateStats, 5000);
    </script>
</body>
</html>
